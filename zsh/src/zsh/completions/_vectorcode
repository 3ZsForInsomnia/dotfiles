#compdef vectorcode

# AUTOMATICALLY GENERATED by `shtab`

# Cache for vectorcode projects
typeset -g _vectorcode_projects_cache
typeset -g _vectorcode_projects_cache_time

# Function to get vectorcode projects with caching
_vectorcode_get_projects() {
  local cache_duration=3600  # 1 hour in seconds
  local current_time=$(date +%s)
  
  # Check if cache is valid
  if [[ -n "$_vectorcode_projects_cache_time" ]] && 
     (( current_time - _vectorcode_projects_cache_time < cache_duration )) &&
     [[ -n "$_vectorcode_projects_cache" ]]; then
    echo "$_vectorcode_projects_cache"
    return 0
  fi
  
  # Refresh cache
  local projects
  projects=$(vectorcode ls 2>/dev/null | 
    awk 'NR > 4 && NF > 0 && !/^-+/ { 
      # Extract first column (project root) and expand tilde
      gsub(/^[ \t]+/, "", $1)  # Remove leading whitespace
      if ($1 ~ /^~/) {
        gsub(/^~/, ENVIRON["HOME"], $1)
      }
      print $1
    }' | 
    sort -u)
  
  if [[ -n "$projects" ]]; then
    _vectorcode_projects_cache="$projects"
    _vectorcode_projects_cache_time="$current_time"
    echo "$projects"
  fi
}

# Completion function for project roots
_vectorcode_complete_projects() {
  local projects
  projects=$(_vectorcode_get_projects)
  if [[ -n "$projects" ]]; then
    local -a project_array
    project_array=(${(f)projects})
    _describe 'vectorcode projects' project_array
  fi
}

_shtab_vectorcode_commands() {
  local _commands=(
    "check:"
    "chunks:"
    "clean:"
    "drop:"
    "files:"
    "init:"
    "ls:"
    "prompts:"
    "query:"
    "update:"
    "vectorise:"
    "version:"
  )
  _describe 'vectorcode commands' _commands
}

_shtab_vectorcode_files_commands() {
  local _commands=(
    "ls:"
    "rm:"
  )
  _describe 'vectorcode files commands' _commands
}

_shtab_vectorcode_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  "(- : *)"{-s,--print-completion}"[Print completion script.]:print_completion:(bash zsh tcsh)"
)

_shtab_vectorcode_check_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  ":Item to be checked. Possible options\: \[config\]:(config)"
  ":Item to be checked. Possible options\: \[config\]:(config)"
)

_shtab_vectorcode_chunks_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  {--overlap,-o}"[Ratio of overlaps between chunks.]:overlap:"
  {-c,--chunk_size}"[Size of chunks (-1 for no chunking).]:chunk_size:"
  "--encoding[Encoding used by the files. See https\:\/\/docs.python.org\/3\/library\/codecs.html\#standard-encodings for supported encodings. Use \`_auto\` for automatic encoding detection.]:encoding:"
  "(*)::Paths to files to be chunked.:_files"
)

_shtab_vectorcode_clean_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
)

_shtab_vectorcode_drop_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
)

_shtab_vectorcode_files_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
)

_shtab_vectorcode_files_ls_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
)

_shtab_vectorcode_files_rm_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  "(*):Files to be removed from the collection.:"
)

_shtab_vectorcode_init_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  {--force,-f}"[Wipe current project config and overwrite with global config (if it exists).]"
  "--hooks[Add git hooks to the current project, if it\'s a git repo.]"
)

_shtab_vectorcode_ls_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
)

_shtab_vectorcode_prompts_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  "(*)::The subcommand(s) to get the prompts for. When not provided, VectorCode will print the prompts for \`query\`.:(query vectorise ls)"
  "(*)::The subcommand(s) to get the prompts for. When not provided, VectorCode will print the prompts for \`query\`.:(query vectorise ls)"
)

_shtab_vectorcode_query_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  {--overlap,-o}"[Ratio of overlaps between chunks.]:overlap:"
  {-c,--chunk_size}"[Size of chunks (-1 for no chunking).]:chunk_size:"
  "--encoding[Encoding used by the files. See https\:\/\/docs.python.org\/3\/library\/codecs.html\#standard-encodings for supported encodings. Use \`_auto\` for automatic encoding detection.]:encoding:"
  {--multiplier,-m}"[Query multiplier.]:multiplier:"
  {-n,--number}"[Number of results to retrieve.]:number:"
  "--exclude[Files to exclude from query results.]:exclude:_files"
  "--absolute[Use absolute path when returning the retrieval results.]"
  "--include[What to include in the final output.]:include:(path document chunk)"
  "(*):Query keywords.:"
)

_shtab_vectorcode_update_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
)

_shtab_vectorcode_vectorise_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
  {--overlap,-o}"[Ratio of overlaps between chunks.]:overlap:"
  {-c,--chunk_size}"[Size of chunks (-1 for no chunking).]:chunk_size:"
  "--encoding[Encoding used by the files. See https\:\/\/docs.python.org\/3\/library\/codecs.html\#standard-encodings for supported encodings. Use \`_auto\` for automatic encoding detection.]:encoding:"
  {--recursive,-r}"[Recursive indexing for directories.]"
  "--include-hidden[Include hidden files.]"
  {--force,-f}"[Force to vectorise the file(s) against the gitignore.]"
  "(*)::Paths to files to be vectorised.:_files"
)

_shtab_vectorcode_version_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "--debug[Enable debug mode.]"
  "--project_root[Project root to be used as an identifier of the project.]:project_root:_vectorcode_complete_projects"
  {--pipe,-p}"[Print structured output for other programs to process.]"
  "--no_stderr[Suppress all STDERR messages.]"
)


_shtab_vectorcode() {
  local context state line curcontext="$curcontext" one_or_more='(-)*' remainder='(*)'

  if ((${_shtab_vectorcode_options[(I)${(q)one_or_more}*]} + ${_shtab_vectorcode_options[(I)${(q)remainder}*]} == 0)); then  # noqa: E501
    _shtab_vectorcode_options+=(': :_shtab_vectorcode_commands' '*::: :->vectorcode')
  fi
  _arguments -C -s $_shtab_vectorcode_options

  case $state in
    vectorcode)
      words=($line[1] "${words[@]}")
      (( CURRENT += 1 ))
      curcontext="${curcontext%:*:*}:_shtab_vectorcode-$line[1]:"
      case $line[1] in
        check) _arguments -C -s $_shtab_vectorcode_check_options ;;
        chunks) _arguments -C -s $_shtab_vectorcode_chunks_options ;;
        clean) _arguments -C -s $_shtab_vectorcode_clean_options ;;
        drop) _arguments -C -s $_shtab_vectorcode_drop_options ;;
        files) _shtab_vectorcode_files ;;
        init) _arguments -C -s $_shtab_vectorcode_init_options ;;
        ls) _arguments -C -s $_shtab_vectorcode_ls_options ;;
        prompts) _arguments -C -s $_shtab_vectorcode_prompts_options ;;
        query) _arguments -C -s $_shtab_vectorcode_query_options ;;
        update) _arguments -C -s $_shtab_vectorcode_update_options ;;
        vectorise) _arguments -C -s $_shtab_vectorcode_vectorise_options ;;
        version) _arguments -C -s $_shtab_vectorcode_version_options ;;
      esac
  esac
}

_shtab_vectorcode_files() {
  local context state line curcontext="$curcontext" one_or_more='(-)*' remainder='(*)'

  if ((${_shtab_vectorcode_files_options[(I)${(q)one_or_more}*]} + ${_shtab_vectorcode_files_options[(I)${(q)remainder}*]} == 0)); then  # noqa: E501
    _shtab_vectorcode_files_options+=(': :_shtab_vectorcode_files_commands' '*::: :->files')
  fi
  _arguments -C -s $_shtab_vectorcode_files_options

  case $state in
    files)
      words=($line[1] "${words[@]}")
      (( CURRENT += 1 ))
      curcontext="${curcontext%:*:*}:_shtab_vectorcode_files-$line[1]:"
      case $line[1] in
        ls) _arguments -C -s $_shtab_vectorcode_files_ls_options ;;
        rm) _arguments -C -s $_shtab_vectorcode_files_rm_options ;;
      esac
  esac
}



typeset -A opt_args

if [[ $zsh_eval_context[-1] == eval ]]; then
  # eval/source/. command, register function for later
  compdef _shtab_vectorcode -N vectorcode
else
  # autoload from fpath, call function directly
  _shtab_vectorcode "$@"
fi
